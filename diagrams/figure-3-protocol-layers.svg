<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="720" viewBox="0 0 1200 720">
  <defs>
    <marker id="arrow" markerWidth="12" markerHeight="12" refX="10" refY="6" orient="auto">
      <path d="M0,0 L12,6 L0,12 Z" fill="#222"/>
    </marker>

    <style>
      .title { font: 700 22px system-ui, -apple-system, Segoe UI, Roboto, Arial; fill:#111; }
      .subtitle { font: 400 14px system-ui, -apple-system, Segoe UI, Roboto, Arial; fill:#333; }
      .label { font: 800 15px system-ui, -apple-system, Segoe UI, Roboto, Arial; fill:#111; }
      .text { font: 400 13px system-ui, -apple-system, Segoe UI, Roboto, Arial; fill:#222; }
      .note { font: 400 12px system-ui, -apple-system, Segoe UI, Roboto, Arial; fill:#444; }
      .layer { fill:#fff; stroke:#222; stroke-width:2; rx:16; ry:16; }
      .layerMuted { fill:#f8f8f8; stroke:#444; stroke-width:1.6; rx:16; ry:16; }
      .divider { stroke:#999; stroke-width:1.2; }
      .arrow { stroke:#222; stroke-width:2.2; fill:none; marker-end:url(#arrow); }
      .dash { stroke:#444; stroke-width:2; fill:none; stroke-dasharray:7 6; marker-end:url(#arrow); }
      .pill { fill:#fff; stroke:#666; stroke-width:1.2; rx:999; ry:999; }
    </style>
  </defs>

  <!-- Header -->
  <text x="40" y="52" class="title">Figure 3 — Protocol Layer Model</text>
  <text x="40" y="78" class="subtitle">Separation of responsibilities: observation, integrity, reasoning, disclosure, and application policy are kept in different layers.</text>

  <!-- Left: Layer stack -->
  <text x="70" y="130" class="label">Core Layers</text>
  <text x="70" y="152" class="note">Each layer can evolve without rewriting the entire protocol.</text>

  <!-- Layer 4 -->
  <rect x="70" y="185" width="640" height="85" class="layerMuted"/>
  <text x="95" y="220" class="label">Layer 4 — Applications & Policy Context</text>
  <text x="95" y="245" class="text">Consumes verified claims to make decisions (visas, compliance, access, audits). Outside protocol control.</text>

  <!-- Arrow down -->
  <path d="M390,270 L390,300" class="arrow"/>

  <!-- Layer 3 -->
  <rect x="70" y="300" width="640" height="85" class="layer"/>
  <text x="95" y="335" class="label">Layer 3 — Disclosure & Verification</text>
  <text x="95" y="360" class="text">User discloses minimum proof. Verifier checks signatures, commitments, and revocations deterministically.</text>

  <!-- Arrow down -->
  <path d="M390,385 L390,415" class="arrow"/>

  <!-- Layer 2 -->
  <rect x="70" y="415" width="640" height="85" class="layer"/>
  <text x="95" y="450" class="label">Layer 2 — Aggregation & Claims</text>
  <text x="95" y="475" class="text">Combines attestations into higher-level claims (duration, counts, thresholds) using public deterministic rules.</text>

  <!-- Arrow down -->
  <path d="M390,500 L390,530" class="arrow"/>

  <!-- Layer 1 -->
  <rect x="70" y="530" width="640" height="85" class="layer"/>
  <text x="95" y="565" class="label">Layer 1 — Blockchain Settlement / Integrity</text>
  <text x="95" y="590" class="text">Anchors commitments (hashes) + timestamps + revocation refs. No raw location, identity, or movement history.</text>

  <!-- Arrow down -->
  <path d="M390,615 L390,645" class="arrow"/>

  <!-- Layer 0 -->
  <rect x="70" y="645" width="640" height="60" class="layer"/>
  <text x="95" y="680" class="label">Layer 0 — Trust & Attesters</text>
  <text x="410" y="680" class="text">Real-world confirmation + signed attestations (scope-limited authority).</text>

  <!-- Right: "What happens where" panel -->
  <rect x="760" y="185" width="400" height="520" class="layerMuted"/>
  <text x="785" y="220" class="label">What Happens Where</text>
  <line x1="785" y1="235" x2="1135" y2="235" class="divider"/>

  <!-- Pills -->
  <rect x="790" y="255" width="355" height="44" class="pill"/>
  <text x="810" y="283" class="text"><tspan class="label">Observation</tspan> happens only in Layer 0</text>

  <rect x="790" y="310" width="355" height="44" class="pill"/>
  <text x="810" y="338" class="text"><tspan class="label">Integrity</tspan> is enforced in Layer 1</text>

  <rect x="790" y="365" width="355" height="44" class="pill"/>
  <text x="810" y="393" class="text"><tspan class="label">Reasoning</tspan> happens in Layer 2</text>

  <rect x="790" y="420" width="355" height="44" class="pill"/>
  <text x="810" y="448" class="text"><tspan class="label">Disclosure</tspan> is controlled in Layer 3</text>

  <rect x="790" y="475" width="355" height="44" class="pill"/>
  <text x="810" y="503" class="text"><tspan class="label">Policy decisions</tspan> occur in Layer 4</text>

  <!-- Dashed connectors to emphasize separation (conceptual) -->
  <path d="M720,338 C740,338 740,338 760,338" class="dash"/>
  <path d="M720,478 C740,478 740,478 760,478" class="dash"/>

  <!-- Footer note -->
  <text x="40" y="710" class="note">
    Design goal: no layer has enough information or authority to reconstruct movement history or override user-controlled disclosure.
  </text>
</svg>

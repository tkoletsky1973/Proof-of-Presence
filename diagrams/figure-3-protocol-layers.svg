<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="720" viewBox="0 0 1200 720">
  <defs>
    <marker id="arrow" markerWidth="12" markerHeight="12" refX="10" refY="6" orient="auto">
      <path d="M0,0 L12,6 L0,12 Z" fill="#222"/>
    </marker>
    <style>
      text { font-family: Arial, Helvetica, sans-serif; }
      .title { font-size:22px; font-weight:700; fill:#111; }
      .subtitle { font-size:14px; font-weight:400; fill:#333; }
      .label { font-size:15px; font-weight:800; fill:#111; }
      .text { font-size:13px; font-weight:400; fill:#222; }
      .note { font-size:12px; font-weight:400; fill:#444; }
      .layer { fill:#fff; stroke:#222; stroke-width:2; rx:14; ry:14; }
      .layerMuted { fill:#f7f7f7; stroke:#444; stroke-width:1.6; rx:14; ry:14; }
      .arrow { stroke:#222; stroke-width:2.2; fill:none; marker-end:url(#arrow); }
      .divider { stroke:#999; stroke-width:1.2; }
      .pill { fill:#fff; stroke:#666; stroke-width:1.2; rx:999; ry:999; }
    </style>
  </defs>

  <!-- Header -->
  <text x="40" y="52" class="title">Figure 3 — Protocol Layer Model</text>
  <text x="40" y="78" class="subtitle">Separation of responsibilities: observation, integrity, reasoning, disclosure, and policy.</text>

  <!-- Layer stack -->
  <text x="70" y="130" class="label">Core Layers</text>
  <text x="70" y="152" class="note">Layers are conceptual boundaries. Implementations may combine them, but responsibilities stay separated.</text>

  <!-- Layer 4 -->
  <rect x="70" y="185" width="640" height="85" class="layerMuted"/>
  <text x="95" y="218" class="label">Layer 4 — Applications & Policy Context</text>
  <text x="95" y="245" class="text">Visa rules, compliance decisions, access control, audits. Outside protocol control.</text>

  <path d="M390,270 L390,300" class="arrow"/>

  <!-- Layer 3 -->
  <rect x="70" y="300" width="640" height="85" class="layer"/>
  <text x="95" y="333" class="label">Layer 3 — Disclosure & Verification</text>
  <text x="95" y="360" class="text">User discloses minimum proof. Verifier checks signatures, commitments, revocations.</text>

  <path d="M390,385 L390,415" class="arrow"/>

  <!-- Layer 2 -->
  <rect x="70" y="415" width="640" height="85" class="layer"/>
  <text x="95" y="448" class="label">Layer 2 — Aggregation & Claims</text>
  <text x="95" y="475" class="text">Combine attestations into claims (duration, counts, thresholds) using public rules.</text>

  <path d="M390,500 L390,530" class="arrow"/>

  <!-- Layer 1 -->
  <rect x="70" y="530" width="640" height="85" class="layer"/>
  <text x="95" y="563" class="label">Layer 1 — Ledger Integrity (Blockchain)</text>
  <text x="95" y="590" class="text">Anchors hashes + timestamps + revocation refs. No raw location or identity stored.</text>

  <path d="M390,615 L390,645" class="arrow"/>

  <!-- Layer 0 -->
  <rect x="70" y="645" width="640" height="60" class="layer"/>
  <text x="95" y="681" class="label">Layer 0 — Trust & Attesters</text>
  <text x="380" y="681" class="text">Real-world confirmation + signed attestations (scope-limited authority).</text>

  <!-- Right panel -->
  <rect x="760" y="185" width="400" height="520" class="layerMuted"/>
  <text x="785" y="220" class="label">What Happens Where</text>
  <line x1="785" y1="235" x2="1135" y2="235" class="divider"/>

  <rect x="790" y="255" width="355" height="44" class="pill"/>
  <text x="810" y="283" class="text"><tspan font-weight="700">Observation</tspan> happens only at Layer 0</text>

  <rect x="790" y="310" width="355" height="44" class="pill"/>
  <text x="810" y="338" class="text"><tspan font-weight="700">Integrity</tspan> is enforced at Layer 1</text>

  <rect x="790" y="365" width="355" height="44" class="pill"/>
  <text x="810" y="393" class="text"><tspan font-weight="700">Reasoning</tspan> happens at Layer 2</text>

  <rect x="790" y="420" width="355" height="44" class="pill"/>
  <text x="810" y="448" class="text"><tspan font-weight="700">Disclosure</tspan> is controlled at Layer 3</text>

  <rect x="790" y="475" width="355" height="44" class="pill"/>
  <text x="810" y="503" class="text"><tspan font-weight="700">Policy</tspan> happens at Layer 4</text>

  <text x="40" y="710" class="note">Design goal: no single layer can reconstruct movement history or override user-controlled disclosure.</text>
</svg>
